<!DOCTYPE html>
<html lang="en" class="darkmode">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/jpg" href="assets/favicon.jpg">
    <title>Sraka</title>
    <style>
        :root {
            --body-background-color: #efefef;
            --visibility-filter: brightness(0);
            --text-color: #1f1f1f;
            --light-border-color: #afafaf;
            --light-background-color: #dfdfdf;
            --opposite-border-color: #3f3f3f;
        }

        html.darkmode {
            --body-background-color: #1f1f1f;
            --visibility-filter: grayscale(1) invert(1);
            --text-color: #efefef;
            --light-border-color: #5f5f5f;
            --light-background-color: #2f2f2f;
            --opposite-border-color: #dfdfdf;
        }

        * {
            margin: 5px 0;
            color: var(--text-color);
        }

        body {
            background-color: var(--body-background-color);
        }

        @keyframes squishy-nigga {
            0% {
                scale: 0.5 1.2;
            }

            50% {
                scale: 1.2 0.5;
            }

            100% {
                scale: 0.5 1.2;
            }
        }

        h1 {
            animation-name: squishy-nigga;
            animation-duration: 1s;
            animation-timing-function: ease-in-out;
            animation-direction: alternate-reverse;
            animation-iteration-count: infinite;

            background-color: blue;
            text-align: center;
            color: white;
        }

        @keyframes rotating-nigga {
            0% {
                rotate: 0deg;
            }

            100% {
                rotate: 360deg;
            }
        }

        h2 {
            animation-name: rotating-nigga;
            animation-duration: 1s;
            animation-timing-function: linear;
            animation-iteration-count: infinite;

            color: red;
            text-align: center;
            font-size: 400%;
        }

        @keyframes invisible-nigga {
            0% {
                opacity: 100%;
            }

            100% {
                opacity: 0;
            }
        }

        h3 {
            animation-name: invisible-nigga;
            animation-duration: 200ms;
            animation-timing-function: linear;
            animation-iteration-count: infinite;

            text-align: center;
            background-color: cyan;
            color: green;
            font-size: 300%;
        }

        #audioPlayerBar {
            position: fixed;
            z-index: 999;
            top: 64px;
            right: 4px;
            background-color: var(--light-background-color);
            border: 1px solid var(--light-border-color);
            border-radius: 5px;
            padding: 5px 10px 5px 10px;
        }

        #audioPlayerBar>img,
        #audioPlayerBar>div:nth-of-type(1) {
            float: left;
        }

        #audioPlayerBar>img {
            width: 48px;
            height: 48px;
        }

        #audioPlayerBar>div:nth-of-type(1) {
            padding-left: 10px;
            height: 48px;
        }

        #audioPlayerBar>div:nth-of-type(1)>h4 {
            margin-top: 0px;
            border-bottom: 1px solid var(--opposite-border-color);
            border-radius: 5%;
        }

        #audioPlayerBar>div:nth-of-type(1)>h5 {
            text-align: center;
        }

        #audioPlayerBar>#volume {
            float: right;
            margin-left: 5px;
            padding: 5px;
            height: 48px;
            accent-color: #8878c3;
        }

        #audioPlayerBar>#timeline {
            clear: both;
            display: block;
            width: 100%;
            accent-color: red;
        }

        #audioPlayerBar>div:nth-of-type(2) {
            clear: both;
            display: flex;
            justify-content: center;
            margin: 10px 0px 0px 0px;
            width: 100%;
        }

        #audioPlayerBar>div:nth-of-type(2)>img {
            float: left;
            display: inline-block;
            margin: 0px;
            padding: 0px 5px 0px 5px;
            width: 24px;
            height: 24px;
            filter: var(--visibility-filter);
        }

        #settingsBar {
            position: fixed;
            z-index: 999;
            top: 10px;
            right: 4px;
            background-color: var(--light-background-color);
            border: 1px solid var(--light-border-color);
            border-radius: 5px;
            padding: 5px 10px 5px 10px;
        }

        #colorModeSwitch {
            width: 24px;
            height: 24px;
            filter: var(--visibility-filter);
            margin: 5px 0px 0px 0px;
        }
    </style>
</head>

<body>
    <div id="audioPlayerBar">
        <img alt="audio icon">
        <div>
            <h4>Title</h4>
            <h5>Author</h5>
        </div>
        <input id="volume" type="range" value="50" step="1" min="0" max="100"
            style="writing-mode: vertical-lr; direction: rtl; appearance: slider-vertical; vertical-align: bottom;">
        <input id="timeline" type="range" value="0" step="1">
        <div>
            <img id="previous" src="assets/icons/previous.svg" alt="previous icon">
            <img id="playback" src="assets/icons/play.svg" alt="play icon">
            <img id="next" src="assets/icons/next.svg" alt="next icon">
        </div>
    </div>

    <div id="settingsBar">
        <img id="colorModeSwitch" src="assets/icons/lightmode.svg" alt="switch dark/light mode">
    </div>

    <mark>i hate niggers</mark>
    <p>pay gorn</p>

    <h2>nig nig nig nig nig</h2>

    <h3>!!!NIGGER!!! !!!NIGGER!!!</h3>
    <h1>!!!NIGGER!!! !!!NIGGER!!! !!!NIGGER!!!</h1>
    <h3>!!!NIGGER!!! !!!NIGGER!!!</h3>

    <h2>nig nig nig nig nig</h2>

    <h3>!!!NIGGER!!! !!!NIGGER!!!</h3>
    <h1>!!!NIGGER!!! !!!NIGGER!!! !!!NIGGER!!!</h1>
    <h3>!!!NIGGER!!! !!!NIGGER!!!</h3>

    <h2>nig nig nig nig nig</h2>

    <h3>!!!NIGGER!!! !!!NIGGER!!!</h3>
    <h1>!!!NIGGER!!! !!!NIGGER!!! !!!NIGGER!!!</h1>
    <h3>!!!NIGGER!!! !!!NIGGER!!!</h3>

    <h2>nig nig nig nig nig</h2>

    <audio id="audioPlayer">
        bocik nie ma audio
    </audio>

    <script>
        const audioPlayer = document.getElementById("audioPlayer");
        const audioPlayerBar = document.getElementById("audioPlayerBar");

        const audioPlayerBarComponents = Object.freeze({
            icon: audioPlayerBar.querySelector("img"),
            title: audioPlayerBar.querySelector("h4"),
            author: audioPlayerBar.querySelector("h5"),
        });

        class AudioController {
            #currentTrack = 0;
            #playing = false;
            #paused = false;
            #soundtracks;
            autoplay = true;

            constructor(soundtracks) {
                this.#soundtracks = soundtracks;
                this.#updateTrackDisplay();
                this.currentTrack.load();
                setInterval(() => {
                    controlButtons.timeline.value = audioPlayer.currentTime;
                    if (audioPlayer.ended && this.autoplay)
                        this.nextTrack();
                }, 100);
            }

            get currentTrack() {
                return this.#soundtracks[this.#currentTrack];
            }

            get playing() {
                return this.#playing;
            }

            get paused() {
                return this.#paused;
            }

            #moveTrack(incrementCallback) {
                incrementCallback();
                this.#updateTrackDisplay();
                this.#playing = false;
                this.#paused = false;
                this.currentTrack.load();
                if (this.autoplay) {
                    this.play();
                    controlButtons.playback.src = "assets/icons/pause.svg";
                }
                else
                    controlButtons.playback.src = "assets/icons/play.svg";
            }

            nextTrack() {
                this.#moveTrack(() => {
                    this.#currentTrack++;
                    if (this.#currentTrack >= this.#soundtracks.length)
                        this.#currentTrack = 0;
                });
            }

            previousTrack() {
                if (audioPlayer.currentTime > 5) {
                    audioPlayer.currentTime = 0;
                    return;
                }

                this.#moveTrack(() => {
                    this.#currentTrack--;
                    if (this.#currentTrack < 0)
                        this.#currentTrack = this.#soundtracks.length - 1;
                });
            }

            play() {
                if (this.#paused && audioPlayer.paused) {
                    audioPlayer.play();
                    this.#paused = false;
                }

                if (this.#playing) {
                    return;
                }

                this.currentTrack.play();
                this.#playing = true;
                this.setVolume(controlButtons.volume.value / 100);
            }

            pause() {
                if (!this.#playing || this.#paused)
                    return;

                audioPlayer.pause();
                this.#paused = true;
            }

            setProgress(newTime) {
                audioPlayer.currentTime = newTime;
            }

            setVolume(newVolume) {
                audioPlayer.volume = Math.min(Math.max(newVolume, 0.0), 1.0);
            }

            #updateTrackDisplay() {
                audioPlayerBarComponents.icon.src = `assets/images/${this.currentTrack.iconPath}`;
                audioPlayerBarComponents.title.innerText = this.currentTrack.title;
                audioPlayerBarComponents.author.innerText = this.currentTrack.author;
            }
        }

        class Soundtrack {
            constructor(title, author, iconPath, trackPath) {
                this.title = title;
                this.author = author;
                this.iconPath = iconPath;
                this.trackPath = trackPath;
            }

            load() {
                audioPlayer.src = `assets/music/${this.trackPath}`;
                audioPlayer.load();
            }

            play() {
                audioPlayer.play();
            }
        }

        const audioController = new AudioController([
            new Soundtrack("HH (Chrisitan Version)", "Kayne West (spring)", "holy.png", "ye_heiljesus.mp3"),
            new Soundtrack("HH", "Kayne West", "hh.png", "ye_hh.mp3"),
            new Soundtrack("Nie mogę oddychać", "Grzesiek Floryda 997", "grzegooorzu.jpg", "grzesio.mp3"),
            new Soundtrack("RU_BOOTLEG", "ilyhiryu", "bootleg.png", "ru_bootleg.mp3"),
        ]);

        const controlButtons = Object.freeze({
            playback: document.getElementById("playback"),
            previous: document.getElementById("previous"),
            next: document.getElementById("next"),
            timeline: document.getElementById("timeline"),
            volume: document.getElementById("volume"),
        });

        audioPlayer.addEventListener("loadedmetadata", () => {
            controlButtons.timeline.max = audioPlayer.duration;
        });

        controlButtons.playback.addEventListener("click", () => {
            if (audioController.playing && !audioController.paused) {
                audioController.pause();
                controlButtons.playback.src = "assets/icons/play.svg";
            } else {
                audioController.play();
                controlButtons.playback.src = "assets/icons/pause.svg";
            }
        });
        controlButtons.previous.addEventListener("click", () => {
            audioController.previousTrack();
        });
        controlButtons.next.addEventListener("click", () => {
            audioController.nextTrack();
        });

        controlButtons.timeline.addEventListener("change", () => {
            audioController.setProgress(controlButtons.timeline.value);
        });
        controlButtons.volume.addEventListener("mousemove", () => {
            audioController.setVolume(controlButtons.volume.value / 100);
        });

        function readCookie(name) {
            name = `${name}=`;
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                cookie = cookie.trim();
                if (cookie.startsWith(name))
                    return cookie.substring(name.length);
            }
            return null;
        }

        function setDarkMode(darkMode) {
            colorModeSwitch.src = `assets/icons/${darkMode ? "lightmode" : "darkmode"}.svg`
            document.documentElement.className = darkMode ? "darkmode" : "";
            const expirationDate = new Date();
            expirationDate.setFullYear(expirationDate.getFullYear() + 1);
            document.cookie = `darkmode=${darkMode}; expires=${expirationDate.toUTCString()}; path=/`;
        }

        const colorModeSwitch = document.getElementById("colorModeSwitch");
        let darkModeCookie = readCookie("darkmode");
        let darkMode = darkModeCookie == null ? true : (darkModeCookie === "true");

        setDarkMode(darkMode);
        colorModeSwitch.addEventListener("click", () => {
            darkMode = !darkMode;
            setDarkMode(darkMode);
        });
    </script>
</body>

</html>
